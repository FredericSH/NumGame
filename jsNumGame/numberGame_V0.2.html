<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Multiplication Gamee</title>
	</head>
	<script>
		var debug = 0;
		
		// these keep extra state data for each cell, indexed by the widget id string
		var targetInfo = [];
		var sourceInfo = [];

		var lowerRange = 1;

		// remember the source and target cells
		var sourceCell = '';
		var targetCell = '';
		
		function selectSource(ident) {
			sourceCell = ident.id;
			if (debug) {
				console.log("From " + ident + ',' + sourceCell);
			}
		}

		function selectTarget(ident) {
			if (sourceCell == '') {
				alert("Select source cell first");
			} else {
				targetCell = ident.id;
				if (debug) {
					console.log("To " + ident + ',' + targetCell);
				}
				if (sourceInfo[sourceCell] == targetInfo[targetCell]) {
					alert("Source matches target!");
					ident.innerHTML = "!";
					sourceCell = '';
					targetCell = '';
				} else {
					alert("Source does not match target, try again");
					targetCell = '';
				}
			}
		}

		function getlowerRange() {
			textInput = document.getElementById("lowerRange").value;
			if (debug) {
				console.log('Got ' + textInput);
			}
			if (textInput == "") {
				lowerRange = 1;
			} else {
				if (parseInt(textInput) > 8) {
					lowerRange = 8;
				} else if (parseInt(textInput) < 1) {
					lowerRange = 1;
				} else {
					lowerRange = textInput;
				}
			}
			if (debug) {
				console.log('lowerRange is ' + lowerRange);
			}
			return;
		}

		function makePage() {
			var t = '<b>Number of Cells (1 to 8)</b>' + '<input type="text" id="lowerRange">' + '<input type="button" value="Redraw Cells" onClick="redrawBoard()"></button>' + '<input type="button" value="Draw Cards" onClick="drawCards()"></button>';
			t += '<table border="" cellspacing="0" cellpadding="0">';
			t += '<td width = "80" height = "80"></td>';
			for ( j = 0; j < 5; j++) {
					t += '<td width = "80" height = "80">'+ (parseInt(lowerRange) + parseInt(j)) +'</td>';
				}
			for ( i = 0; i < 5; i++) {
				t += '<tr>';
				t += '<td width = "80" height = "80" >' + (parseInt(lowerRange) + parseInt(i)) + '</td>';
				var innerNum = parseInt(i) + parseInt(lowerRange);
				for ( j = 0; j < 5; j++) {
					var ident = 'T' + j + i;
					// save the number associated with the cell
					targetInfo[ident] = innerProduct;
					if (debug) {
						console.log(j);
					}
					var innerProduct = innerNum * (parseInt(j) + parseInt(lowerRange));
					t += '<td id = ' + ident + ' width = "80" height = "80" onclick="selectTarget(' + innerProduct + ')">' + innerProduct + '</td>';
				}
				t += '</tr>';
			}
			t += '</table>';
			t += drawSource();
			return t;
		}
		
		function drawSource(){
			var t = '<table id="handOfCards" border="" cellspacing="0" cellpadding="0">';
			for ( i = 0; i < 2; i++) {
				t += '<tr>';
				t += '<td width = "80" height = "80" >Source</td>';
				for ( j = 0; j < 5; j++) {
					var upperProduct = (parseInt(lowerRange) + 4) * (parseInt(lowerRange) + 4);
					var lowerProduct = parseInt(lowerRange) * parseInt(lowerRange);
					var ranProd = Math.floor(Math.random() * upperProduct + lowerProduct);
					var ident = 'S' + j + i;
					// save the number associated with the cell
					sourceInfo[ident] = ranProd;
					if (debug) {
						console.log(j);
					}
					var intext = "<font size ='6'><pre>  " + ranProd + "</pre></font>";
					t += '<td id = ' + ident + ' width = "80" height = "80" onclick="selectSource(' + ranProd + ')">' + intext + '</td>';
				}
				t += '</tr>';
			}
			t += '</table>';
			return t;
		}
		
		function drawCards(){
			handOfCards.innerHTML = "";
			handOfCards.innerHTML = drawSource();
		}

		function drawBoard() {
			document.body.innerHTML = makePage();
		}

		function redrawBoard() {
			getlowerRange();
			drawBoard();
		}
	</script>

	<body onload ="drawBoard()"></body>
</html>
